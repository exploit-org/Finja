package org.exploit.evm.protocol;

import lombok.RequiredArgsConstructor;
import org.exploit.crypto.Hash;
import org.exploit.evm.service.TransactionService;
import org.exploit.finja.core.OutgoingTransaction;
import org.exploit.finja.core.model.Receipt;
import org.web3j.utils.Numeric;

@RequiredArgsConstructor
public class EthOutgoing implements OutgoingTransaction {
    private final String signedHex;
    private final Transaction transaction;
    private final TransactionService transactionService;

    @Override
    public String dump() {
        return signedHex;
    }

    @Override
    public String computeTxid() {
        return Numeric.toHexString(Hash.keccak256(Numeric.hexStringToByteArray(signedHex)));
    }

    @Override
    public Receipt send() {
        var txid = transactionService.sendTransaction(signedHex);

        return new Receipt(txid, transaction.fee().longValue());
    }

    @Override
    public long fee() {
        return transaction.fee().longValue();
    }
}
