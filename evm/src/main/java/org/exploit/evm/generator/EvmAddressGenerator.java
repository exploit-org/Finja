package org.exploit.evm.generator;

import org.bouncycastle.util.BigIntegers;
import org.exploit.crypto.curve.Secp256k1Provider;
import org.exploit.crypto.key.ECKeyPair;
import org.exploit.finja.core.AddressGenerator;
import org.exploit.finja.core.constant.Asset;
import org.exploit.finja.core.model.CommonAddress;
import org.exploit.finja.utils.SensitiveBytes;
import org.exploit.evm.utils.EthKeys;

public class EvmAddressGenerator implements AddressGenerator {
    @Override
    public CommonAddress generate() {
        var keyPair = Secp256k1Provider.getInstance().generateKeyPair();
        var address = generate(keyPair);

        keyPair.erase();

        return address;
    }

    @Override
    public CommonAddress generate(ECKeyPair keyPair) {
        var publicAddress = "0x" + EthKeys.getAddress(keyPair.publicKey());
        var ecPriv = keyPair.privateKey();

        var privateKey = (ecPriv != null) ? BigIntegers.asUnsignedByteArray(keyPair.privateKey().toBigInt())
                : new byte[0];

        return new CommonAddress(publicAddress, SensitiveBytes.write(privateKey));
    }

    @Override
    public Asset asset() {
        return Asset.EVM;
    }
}
