package org.exploit.evm.utils;

import org.bouncycastle.util.encoders.Hex;
import org.exploit.crypto.Hash;
import org.exploit.crypto.key.ECPublicKey;
import org.exploit.crypto.key.secp256k1.Secp256k1PrivateKey;
import org.exploit.secp256k1.Secp256k1PointOps;
import org.web3j.utils.Numeric;

import java.util.Arrays;

public final class EthKeys {
    private EthKeys() {
    }

    public static byte[] getAddress(byte[] publicKey) {
        var noPrefixKey = Arrays.copyOfRange(publicKey, 1, publicKey.length);
        var hash = Hash.keccak256(noPrefixKey);

        return Arrays.copyOfRange(hash, hash.length - 20, hash.length);
    }

    public static Secp256k1PrivateKey getPrivateKey(String hex) {
        return new Secp256k1PrivateKey(Numeric.hexStringToByteArray(hex));
    }

    public static String getAddress(ECPublicKey<Secp256k1PointOps> publicKey) {
        return Hex.toHexString(getAddress(publicKey.encoded()));
    }
}