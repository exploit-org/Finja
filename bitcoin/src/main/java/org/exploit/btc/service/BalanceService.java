package org.exploit.btc.service;

import org.exploit.btc.BitcoinProtocolProvider;
import org.exploit.btc.protocol.UTXO;
import org.exploit.finja.core.CoinBalanceService;
import org.exploit.finja.core.model.Value;

import java.math.BigInteger;

public class BalanceService implements CoinBalanceService {
    private final BitcoinProtocolProvider provider;

    public BalanceService(BitcoinProtocolProvider provider) {
        this.provider = provider;
    }

    @Override
    public Value balance(String address) {
        var utxos = provider.explorer().utxos(address);

        var value = BigInteger.valueOf(utxos.stream().map(UTXO::amount)
                .reduce(Long::sum)
                .orElse(0L));

        var humanAmount = provider.converter().toHuman(value);

        return new Value(humanAmount, value);
    }
}
