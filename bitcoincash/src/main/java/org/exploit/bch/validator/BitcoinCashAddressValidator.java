package org.exploit.bch.validator;

import lombok.RequiredArgsConstructor;
import org.exploit.bch.BitcoinCashProvider;
import org.exploit.finja.core.AddressValidator;

import java.util.regex.Pattern;

@RequiredArgsConstructor
public class BitcoinCashAddressValidator implements AddressValidator {
    private static final Pattern REGEX = Pattern.compile("(bitcoincash:|bchtest:|bchreg:)?[qpzry9x8gf2tvdw0s3jn54khce6mua7l]{42}");

    private final BitcoinCashProvider provider;

    @Override
    public boolean isValidAddress(String address) {
        if (!REGEX.matcher(address).matches())
            return false;

        try {
            provider.getScript(address);
            return true;
        } catch (IllegalArgumentException e) {
            return false;
        }
    }
}
