package org.exploit.hdwallet.model;

import lombok.Data;
import lombok.Getter;

import java.util.ArrayList;
import java.util.List;

@Getter
public class HDPath {
    private final List<Index> indexes = new ArrayList<>();

    public Index indexAt(int index) {
        if (indexes.size() < index)
            return null;

        return indexes.get(index);
    }

    public void addIndex(Index index) {
        indexes.add(index);
    }

    @Override
    public String toString() {
        var sb = new StringBuilder();
        sb.append("m");

        for (var index : indexes) {
            sb.append("/");
            sb.append(index.getValue());

            if (index.isHardened())
                sb.append("'");
        }

        return sb.toString();
    }

    @Data
    public static class Index {
        private int value;
        private boolean isHardened;
    }

    public static HDPath parse(String path) {
        var hdPath = new HDPath();
        var parts = path.split("/");

        for (var part : parts) {
            if (!part.equals("m")) {
                var index = new Index();
                index.setHardened(part.endsWith("'"));
                index.setValue(Integer.parseInt(part.replace("'", "")));

                hdPath.addIndex(index);
            }
        }

        return hdPath;
    }
}
