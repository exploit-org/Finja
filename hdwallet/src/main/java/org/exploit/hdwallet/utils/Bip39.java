package org.exploit.hdwallet.utils;

import org.exploit.hdwallet.exception.WordListLoadingException;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;
import java.util.List;

public final class Bip39 {
    private Bip39() {
    }

    private static volatile List<String> BIP39_WORD_LIST;

    public static List<String> getWordList() {
        if (BIP39_WORD_LIST == null) {
            synchronized (Bip39.class) {
                if (BIP39_WORD_LIST == null) {
                    BIP39_WORD_LIST = loadWordList();
                }
            }
        }

        validateWordListSize(BIP39_WORD_LIST);
        return BIP39_WORD_LIST;
    }

    private static List<String> loadWordList() {
        List<String> words = new ArrayList<>();

        try (var in = Bip39.class.getClassLoader().getResourceAsStream("english.txt");
             var reader = new BufferedReader(new InputStreamReader(in))
        ) {
            String line;
            while ((line = reader.readLine()) != null) {
                words.add(line.trim());
            }
        } catch (IOException e) {
            throw new WordListLoadingException("Error loading BIP39 word list.", e);
        }

        return words;
    }

    private static void validateWordListSize(List<String> wordList) {
        if (wordList.size() != 2048) throw new WordListLoadingException("Word list size is not 2048.");
    }
}