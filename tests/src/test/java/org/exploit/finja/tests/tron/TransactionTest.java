package org.exploit.finja.tests.tron;

import org.exploit.crypto.key.secp256k1.Secp256k1PrivateKey;
import org.exploit.finja.core.constant.AmountUnit;
import org.exploit.finja.core.model.Amount;
import org.exploit.finja.core.model.WebData;
import org.exploit.jettyx.auth.NoAuth;
import org.exploit.tron.TronProvider;
import org.junit.jupiter.api.Test;

import java.math.BigDecimal;

import static org.junit.jupiter.api.Assertions.assertNotNull;

public class TransactionTest {
    private final TronProvider provider = TronProvider.newBuilder()
            .node(WebData.create("https://api.shasta.trongrid.io", new NoAuth()))
            .build();

    @Test
    public void transactionTest() {
        var privateKey = Secp256k1PrivateKey.create(System.getenv("TRON_PRIVATE_KEY"))
                .encoded();

        var wallet = provider.createWallet(privateKey);
        var amount = new Amount(new BigDecimal("0.001"), AmountUnit.HUMAN);
        var targetAddress = "TTAoLEaSquVHxQdriPwddGU6eNki8GeJVG";

        var tx = wallet.transaction(targetAddress, amount);

        var receipt = tx.send();
        var txid = receipt.txid();
        assertNotNull(txid);
    }
}
